
// 秒杀倒计时
+ function($) {
   var options = {
       attrName: 'data-countdown',
       start: '<b>%{h}</b>:<b>%{m}</b>:<b>%{s}</b>',
       end: '<b>00</b>:<b>00</b>:<b>00</b>',
       afterEnd: null
   };
   function trimZero(str) {
       return parseInt(str.replace(/^0/g, ''));
   }

   function getDiffTime(str) {
       var m;
       if ((m = /^(\d{4})[^\d]+(\d{1,2})[^\d]+(\d{1,2})\s+(\d{2})[^\d]+(\d{1,2})[^\d]+(\d{1,2})$/.exec(str))) {
           var year = trimZero(m[1]),
               month = trimZero(m[2]) - 1,
               day = trimZero(m[3]),
               hour = trimZero(m[4]),
               minute = trimZero(m[5]),
               second = trimZero(m[6]);
           return Math.floor((new Date(year, month, day, hour, minute, second).getTime() - new Date().getTime()) / 1000);
       }
       return parseInt(str);
   }

   function format(diff) {
       var start = options.start,
           day, hour, minute, second;
       day = /%\{d\}/.test(start) ? Math.floor(diff / 86400) : 0;
       hour = Math.floor((diff - day * 86400) / 3600);
       minute = Math.floor((diff - day * 86400 - hour * 3600) / 60);
       second = diff - day * 86400 - hour * 3600 - minute * 60;
       if (day == 0) day = '00';
       else if (day < 10) day = '0' + day
       if (hour == 0) hour = '00';
       else if (hour < 10) hour = '0' + hour
       if (minute == 0) minute = '00';
       else if (minute < 10) minute = '0' + minute
       if (second == 0) second = '00';
       else if (second < 10) second = '0' + second
       start = start.replace(/%\{d\}/ig, day)
           .replace(/%\{h\}/ig, hour)
           .replace(/%\{m\}/ig, minute)
           .replace(/%\{s\}/ig, second);
       return start;
   }

    var $j_countdown = function(){
       $('.j_Countdown').each(function() {
           var el = this,
               diff = getDiffTime($(el).attr(options.attrName));
           function update() {
               if (diff <= 0) {
                   $(el).html(options.end);
                   if (options.afterEnd) {
                       options.afterEnd();
                   }
                   return;
               }
               $(el).html(format(diff));
               setTimeout(function() {
                   diff--;
                   update();
               }, 1000);
           }
           update();
       });
   }
   window.$j_countdown = $j_countdown
}(jQuery);



